{% extends "layout.html" %}

{% block title %}UML Diagram - {{ file.original_filename }}{% endblock %}

{% block extra_head %}
<script src="{{ url_for('static', filename='js/diagram.js') }}"></script>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('view_history') }}">History</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('analyze_owl', filename=file.filename) }}">{{ file.original_filename }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">UML Diagram</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3>UML Class Diagram for {{ file.original_filename }}</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <p>This UML diagram represents the class hierarchy and relationships in your ontology.</p>
                        <p><strong>Color Key:</strong>
                            <span class="badge bg-light text-dark" style="background-color: #D4E6F1 !important;">Blue classes</span> are from BFO/IAO,
                            <span class="badge bg-light text-dark" style="background-color: #D5F5E3 !important;">Green classes</span> are domain-specific.
                        </p>
                    </div>

                    <div class="alert alert-info mb-4">
                        <h4><i class="fas fa-info-circle"></i> Diagram Visualization</h4>
                        <p>To visualize this diagram, copy the PlantUML code below and paste it into the 
                        <a href="https://www.plantuml.com/plantuml/uml/" target="_blank" class="alert-link">
                            PlantUML Web Server <i class="fas fa-external-link-alt"></i>
                        </a>.</p>
                    </div>

                    <div class="card mb-3">
                        <div class="card-header">
                            <h4>PlantUML Source Code</h4>
                        </div>
                        <div class="card-body">
                            <div class="position-relative">
                                <button class="btn btn-outline-primary position-absolute top-0 end-0 m-2" 
                                        onclick="copyToClipboard(document.getElementById('plantuml-code').textContent)" 
                                        title="Copy PlantUML code">
                                    <i class="fas fa-clipboard"></i> Copy
                                </button>
                                <pre class="bg-dark text-light p-3" id="plantuml-code" style="max-height: 400px; overflow-y: auto; margin-top: 40px;">{{ plantuml_code }}</pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="btn-group">
                        <a href="{{ url_for('analyze_owl', filename=file.filename) }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Analysis
                        </a>
                        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#diagramOptions" aria-expanded="false">
                            <i class="fas fa-cog"></i> Diagram Options
                        </button>
                    </div>
                    
                    <div class="collapse mt-3" id="diagramOptions">
                        <div class="card card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="include-individuals" name="individuals">
                                        <label class="form-check-label" for="include-individuals">Include individuals</label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="include-data-properties" name="data_properties" checked>
                                        <label class="form-check-label" for="include-data-properties">Include data properties</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="include-annotation-properties" name="annotation_properties">
                                        <label class="form-check-label" for="include-annotation-properties">Include annotation properties</label>
                                    </div>
                                    <div class="mb-3">
                                        <label for="max-classes" class="form-label">Max classes to display:</label>
                                        <input type="number" class="form-control" id="max-classes" name="max_classes" value="100" min="10" max="500">
                                    </div>
                                </div>
                            </div>
                            <button type="button" onclick="regenerateDiagram()" class="btn btn-primary mt-2">Regenerate Diagram</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}